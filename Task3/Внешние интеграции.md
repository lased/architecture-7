# Внешние интеграции

## Диаграмма контекста новых бизнес-функции

```mermaid
    C4Context
      title Диаграмма контекста новых бизнес-функции

      System_Boundary(SmartHome, "Система умного дома PropDevelopment") {
        Person(owner, "Собственник", "Владелец квартиры")
        Person(guest, "Гость")
        Person(car, "Автомобиль")

        System(mobile, "Мобильное приложение", "Управление умным домом")
        System(smartHomePlatform, "Платформа умного дома", "Партнерская система управления умным домом")
        System(accessControl, "Система контроля доступом", "Упарвление доступом через домофон и щлагбауум")

      }

      Rel(owner, mobile, "Использует")
      Rel(car, accessControl, "Взаимодействует", "Биометрия")
      Rel(guest, accessControl, "Взаимодействует", "Номер машины")
      Rel(mobile, smartHomePlatform, "Отправка команд")
      Rel(smartHomePlatform, accessControl, "Упраление доступами")

UpdateLayoutConfig($c4ShapeInRow="3", $c4BoundaryInRow="1")
```

## Требования к внешним интеграциям

1. Безопасность:
  - Шифрование передачи данных (TLS/SSL) для всех API запросов между системами.
  - Автоматическое обновление и поддержка последних версий шифровальных протоколов.
  - Защита от SQL инъекций, XSS, CSRF атак через кодирование выводимых данных и фильтрацию входных параметров.
  - Ролевая система доступов (RBAC) для пользователей с различными уровнем прав.

2. Протоколы аутентификации:
  - OAuth 2.0 с использованием токенов Bearer для авторизации клиентских приложений.
  - JWT токены для сохранения состояния и быстрой проверки подлинности пользователей.
  
3. Взаимодействие систем:
  - REST API на основе стандартов OpenAPI/Swagger для взаимодействия между компонентами системы PropDevelopment и сервисами партнёра. 
  - Обмен данными в форматах JSON.
  - Синхронные (GET, POST, PUT) и асинхронные (WebSockets, Long-Polling) запросы для обеспечения взаимодействия.

4. Интеграция с мобильным приложением:
  - Внедрение SDK в мобильное приложение собственников PropDevelopment.
  - Обеспечение API ключей и секретов через хранилище конфигурации (например, HashiCorp Vault).
  
5. Ожидаемые события от партнерской платформы:
  - Запросы на добавление/удаление пользователей и разрешений доступа.
  - События об изменении состояния устройств (доступ открыт/закрыт, видео с камер).
  - Уведомления о нарушениях безопасности или проблемах с функционалом.
